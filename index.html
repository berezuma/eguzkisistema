<!DOCTYPE html>
<html lang="eu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eguzki Sistemaren Simulazioa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
        }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
        }
        #container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .sidebar-item {
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .sidebar-item.active {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
        }
        .label {
            position: absolute;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            user-select: none;
            text-shadow: 1px 1px 2px black;
            z-index: 5;
            transform: translate(-50%, -150%);
        }
        /* Sidebar trantsizioa */
        #sidebar {
            transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
        }
        #info-panel {
            transition: right 0.4s ease-in-out, opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="fixed inset-0 w-full h-full">
        <!-- Menu botoia mugikorretarako -->
        <button id="menu-btn" class="md:hidden fixed top-4 left-4 z-50 bg-gray-800/80 p-2 rounded-md backdrop-blur-sm">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
        </button>

        <div class="flex h-screen">
            <!-- Ezkerreko zutabea (nabigazioa) -->
            <aside id="sidebar" class="absolute md:relative top-0 left-0 h-full w-64 bg-gray-800 p-4 flex flex-col z-40 shadow-lg transform -translate-x-full md:translate-x-0">
                <h2 class="text-xl font-bold text-center mb-1 text-blue-300">Eguzki-sistema</h2>
                <p class="text-center text-xs text-gray-400 mb-2">labur.eus/eguzki-sistema</p>
                <div id="sidebar-list" class="flex-grow space-y-1 overflow-y-auto pr-2">
                    <!-- Zerrenda hemen sortuko da JavaScript-ekin -->
                </div>
                <div class="mt-auto pt-2 border-t border-gray-700">
                    <a href="https://eu.wikipedia.org/wiki/Txikipedia:Eguzki-sistema" target="_blank" rel="noopener noreferrer" class="block w-full text-center p-2 rounded-md bg-gray-700 hover:bg-blue-600 transition-colors text-sm">
                        Gehiago ikasi Txikipedian
                    </a>
                    <div class="mt-2 text-center text-xs text-gray-400">
                        <p>Egilea: <a href="https://berezuma.com" target="_blank" rel="noopener noreferrer" class="underline hover:text-white">Beñat Erezuma Arisketa</a></p>
                        <p>Lizentzia: CC-BY-SA 4.0</p>
                    </div>
                </div>
            </aside>

            <!-- Simulazioa -->
            <main class="flex-1 relative">
                <div id="container"></div>
                <div id="labels-container"></div>
                
                <!-- Partekatu botoia -->
                <button id="share-btn" title="Partekatu" class="absolute top-4 right-4 z-20 bg-gray-800/80 p-2 rounded-full backdrop-blur-sm hover:bg-gray-700 transition-colors">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"></path></svg>
                </button>
                
                <!-- Informazio panela -->
                <div id="info-panel" class="fixed md:absolute 
                    top-1/2 left-1/2 md:top-5 md:left-auto
                    md:right-[-400px]
                    w-11/12 max-w-lg md:w-[350px] 
                    h-auto max-h-[85vh] md:max-h-[calc(100vh-40px)] 
                    bg-gray-800 md:bg-gray-900/80 md:backdrop-blur-sm text-white 
                    p-6 rounded-lg md:rounded-l-lg md:rounded-r-none
                    z-[60]
                    border border-gray-700
                    opacity-0 pointer-events-none
                    -translate-x-1/2 -translate-y-1/2 md:translate-x-0 md:translate-y-0
                    ">
                    <span id="close-info-btn" class="absolute top-2 right-3 cursor-pointer text-3xl text-gray-400 hover:text-white">&times;</span>
                    <div id="info-content" class="overflow-y-auto max-h-[calc(85vh-48px)] md:max-h-full">
                        <h2 id="planet-name" class="text-2xl font-bold mb-4 text-blue-300"></h2>
                        <img id="planet-image" src="" alt="Irudia" class="w-full h-48 object-cover rounded-lg mb-4">
                        <p id="planet-description" class="text-gray-300 mb-4 text-sm"></p>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div><strong class="text-blue-400">Diametroa:</strong> <span id="planet-diameter"></span></div>
                            <div><strong class="text-blue-400">Masa:</strong> <span id="planet-mass"></span></div>
                            <div><strong class="text-blue-400">Grabitatea:</strong> <span id="planet-gravity"></span></div>
                            <div><strong class="text-blue-400">Errotazioa:</strong> <span id="planet-rotation"></span></div>
                            <div><strong class="text-blue-400">Translazioa:</strong> <span id="planet-orbit-period"></span></div>
                            <div><strong class="text-blue-400">Distantzia:</strong> <span id="planet-distance"></span></div>
                            <div><strong class="text-blue-400">Batez besteko tenperatura:</strong> <span id="planet-temperature"></span></div>
                            <div><strong class="text-blue-400">Sateliteak:</strong> <span id="planet-moons"></span></div>
                        </div>
                    </div>
                </div>

                <!-- Kontrol botoiak -->
                <div class="absolute bottom-16 inset-x-4 flex justify-center items-center gap-4 z-20">
                    <button id="pause-btn" title="Pausatu/Jarraitu" class="bg-slate-800/70 text-white p-3 rounded-lg shadow-lg hover:bg-slate-700 transition-colors border border-slate-600">
                        <svg id="pause-icon" class="w-7 h-7 pointer-events-none" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                        <svg id="play-icon" class="w-7 h-7 hidden pointer-events-none" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                    </button>
                    <button id="reset-view-btn" title="Ikuspegi Orokorra" class="bg-slate-800/70 text-white p-3 rounded-lg shadow-lg hover:bg-slate-700 transition-colors border border-slate-600">
                        <svg class="w-7 h-7 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 10V4h6 M10 10L4 4 M14 4h6v6 M14 10l6-6 M4 14v6h6 M10 14l-6 6 M14 20h6v-6 M14 14l6 6"></path></svg>
                    </button>
                    <button id="toggle-labels-btn" title="Erakutsi/Ezkutatu Etiketak" class="bg-slate-800/70 text-white p-3 rounded-lg shadow-lg hover:bg-slate-700 transition-colors border border-slate-600">
                        <svg id="labels-on-icon" class="w-7 h-7 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        <svg id="labels-off-icon" class="w-7 h-7 hidden pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path></svg>
                    </button>
                </div>
            </main>
        </div>
        <!-- Atzeko geruza iluna menua irekitzean -->
        <div id="overlay" class="fixed inset-0 bg-black/50 z-30 hidden md-hidden"></div>
        <!-- Atzeko geruza iluna info-panel-erako (mugikorrean) -->
        <div id="info-overlay" class="fixed inset-0 bg-black/60 z-50 hidden md-hidden"></div>
    </div>
    
    <!-- Jakinarazpena -->
    <div id="notification" class="fixed bottom-5 right-5 bg-green-600 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50">
        Esteka arbelean kopiatu da!
    </div>
    
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const planetData = {
                'Eguzkia': { name: 'Eguzkia', diameter: '1.392.700 km', mass: '1,989 × 10^30 kg', gravity: '274 m/s²', rotation: '25-35 egun', orbitPeriod: 'N/A', distance: '0', temperature: '5.505 °C (azalean)', moons: 'N/A', description: 'Eguzki-sistemaren erdiko izarra. Sistema honetako objektu handiena da, masaren %99,86 hartzen baitu.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/The_Sun_by_the_Atmospheric_Imaging_Assembly_of_NASA%27s_Solar_Dynamics_Observatory_-_20100819.jpg/640px-The_Sun_by_the_Atmospheric_Imaging_Assembly_of_NASA%27s_Solar_Dynamics_Observatory_-_20100819.jpg' },
                'Merkurio': { name: 'Merkurio', diameter: '4.879 km', mass: '3,285 × 10^23 kg', gravity: '3,7 m/s²', rotation: '58,6 egun', orbitPeriod: '88 egun', distance: '57,9 milioi km', temperature: '-173°C / 427°C (min/max)', moons: '0', description: 'Eguzkitik hurbilen dagoen planeta eta sistemako txikiena.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Mercury_in_true_color.jpg/640px-Mercury_in_true_color.jpg' },
                'Artizarra (Venus)': { name: 'Artizarra (Venus)', diameter: '12.104 km', mass: '4,867 × 10^24 kg', gravity: '8,87 m/s²', rotation: '243 egun (erretrogradoa)', orbitPeriod: '225 egun', distance: '108,2 milioi km', temperature: '462 °C', moons: '0', description: 'Lurraren "planeta bikia" deitua, tamaina eta konposizio antzekoak dituelako.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Venus-real_color.jpg/640px-Venus-real_color.jpg' },
                'Lurra': { name: 'Lurra', diameter: '12.742 km', mass: '5,972 × 10^24 kg', gravity: '9,8 m/s²', rotation: '23,9 ordu', orbitPeriod: '365,25 egun', distance: '149,6 milioi km', temperature: '15 °C', moons: '1 (Ilargia)', description: 'Gure etxea eta ezagutzen dugun bizia duen planeta bakarra.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/640px-The_Earth_seen_from_Apollo_17.jpg' },
                'Marte': { name: 'Marte', diameter: '6.779 km', mass: '6,39 × 10^23 kg', gravity: '3,71 m/s²', rotation: '24,6 ordu', orbitPeriod: '687 egun', distance: '227,9 milioi km', temperature: '-65 °C', moons: '2 (Fobos eta Deimos)', description: '"Planeta Gorria" bezala ezaguna, bere gainazaleko burdin oxidoagatik.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/OSIRIS_Mars_true_color.jpg/640px-OSIRIS_Mars_true_color.jpg' },
                'Jupiter': { name: 'Jupiter', diameter: '139.820 km', mass: '1,898 × 10^27 kg', gravity: '24,79 m/s²', rotation: '9,9 ordu', orbitPeriod: '11,9 urte', distance: '778,5 milioi km', temperature: '-145 °C (hodei-goian)', moons: '95+', description: 'Eguzki-sistemako planetarik handiena. Bere ezaugarri nagusia Orban Gorri Handia da.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Jupiter_and_its_shrunken_Great_Red_Spot.jpg/640px-Jupiter_and_its_shrunken_Great_Red_Spot.jpg' },
                'Saturno': { name: 'Saturno', diameter: '116.460 km', mass: '5,683 × 10^26 kg', gravity: '10,44 m/s²', rotation: '10,7 ordu', orbitPeriod: '29,5 urte', distance: '1.434 milioi km', temperature: '-178 °C (hodei-goian)', moons: '146+', description: 'Bere eraztun sistemagatik ezaguna den gas erraldoia.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Saturn_during_Equinox.jpg/640px-Saturn_during_Equinox.jpg' },
                'Urano': { name: 'Urano', diameter: '50.724 km', mass: '8,681 × 10^25 kg', gravity: '8,69 m/s²', rotation: '17,2 ordu (erretrogradoa)', orbitPeriod: '84 urte', distance: '2.871 milioi km', temperature: '-224 °C (hodei-goian)', moons: '27', description: 'Izotzezko erraldoi bat da, eta bere ardatza ia etzanda duena.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Uranus2.jpg/640px-Uranus2.jpg' },
                'Neptuno': { name: 'Neptuno', diameter: '49.244 km', mass: '1,024 × 10^26 kg', gravity: '11,15 m/s²', rotation: '16,1 ordu', orbitPeriod: '164,8 urte', distance: '4.495 milioi km', temperature: '-214 °C (hodei-goian)', moons: '14', description: 'Eguzkitik urrunen dagoen planeta.', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg/640px-Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg' }
            };

            let scene, camera, renderer, controls;
            const planets = {}; 
            let labelsVisible = true;
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            let selectedObject = null;
            let followedObject = null;
            let targetWorldPosition = new THREE.Vector3();
            let isPaused = false;
            let isMenuOpen = false;

            let pointerDownX = 0;
            let pointerDownY = 0;

            function init() {
                const container = document.getElementById('container');
                scene = new THREE.Scene();
                
                const textureLoader = new THREE.TextureLoader();
                const backgroundTexture = textureLoader.load('https://raw.githubusercontent.com/stemkoski/stemkoski.github.com/master/Three.js/images/starfield.jpg');
                scene.background = backgroundTexture;

                camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 2000);
                camera.position.set(0, 50, 150);
                camera.lookAt(0, 0, 0);

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                container.appendChild(renderer.domElement);

                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.minDistance = 10;
                controls.maxDistance = 800;
                
                createSolarSystem();
                createSidebar();

                // Gertaerak (Event Listeners)
                window.addEventListener('resize', onWindowResize, false);
                container.addEventListener('pointerdown', onPointerDown, false);
                container.addEventListener('pointerup', onPointerUp, false);
                document.getElementById('menu-btn').addEventListener('click', () => toggleMenu(!isMenuOpen));
                document.getElementById('close-info-btn').addEventListener('click', () => toggleInfoPanel(false));
                
                document.getElementById('share-btn').addEventListener('pointerdown', shareProject);
                document.getElementById('pause-btn').addEventListener('pointerdown', togglePause);
                document.getElementById('reset-view-btn').addEventListener('pointerdown', resetView);
                
                document.getElementById('toggle-labels-btn').addEventListener('pointerdown', () => {
                    labelsVisible = !labelsVisible;
                    const labelsOnIcon = document.getElementById('labels-on-icon');
                    const labelsOffIcon = document.getElementById('labels-off-icon');

                    document.getElementById('labels-container').style.display = labelsVisible ? 'block' : 'none';
                    
                    if (labelsVisible) {
                        labelsOnIcon.classList.remove('hidden');
                        labelsOffIcon.classList.add('hidden');
                    } else {
                        labelsOnIcon.classList.add('hidden');
                        labelsOffIcon.classList.remove('hidden');
                    }
                });

                document.getElementById('overlay').addEventListener('click', () => toggleMenu(false));
                document.getElementById('info-overlay').addEventListener('click', () => toggleInfoPanel(false));
            }
            
            function onPointerDown(event) {
                pointerDownX = event.clientX;
                pointerDownY = event.clientY;
            }

            function onPointerUp(event) {
                const deltaX = Math.abs(event.clientX - pointerDownX);
                const deltaY = Math.abs(event.clientY - pointerDownY);

                // If the pointer moved less than a threshold (e.g., 5 pixels), consider it a tap/click
                if (deltaX < 5 && deltaY < 5) {
                    onContainerClick(event);
                }
            }

            function toggleMenu(show) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('overlay');
                isMenuOpen = show;
                if (show) {
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                } else {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('hidden');
                }
            }

            function createSidebar() {
                const sidebarList = document.getElementById('sidebar-list');
                Object.values(planetData).forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = item.name;
                    button.dataset.name = item.name;
                    button.className = 'sidebar-item w-full text-left p-2 rounded-md hover:bg-gray-700';
                    button.onclick = () => {
                        selectObjectByName(item.name);
                    };
                    sidebarList.appendChild(button);
                });
            }
            
            function selectObjectByName(name) {
                if (window.innerWidth < 768) {
                    toggleMenu(false);
                }

                const object = planets[name];
                if (object) {
                    selectedObject = object;
                    if (object.name !== 'Eguzkia') {
                        followedObject = object;
                    } else {
                        // Eguzkia hautatzean, ez egin zoom-a, mantendu ikuspegi orokorra
                        followedObject = null; 
                        controls.target.set(0, 0, 0); 
                    }
                    updateInfoPanel(name);
                }
            }
            
            function togglePause() { 
                isPaused = !isPaused;
                const pauseIcon = document.getElementById('pause-icon');
                const playIcon = document.getElementById('play-icon');
                if (isPaused) {
                    pauseIcon.classList.add('hidden');
                    playIcon.classList.remove('hidden');
                } else {
                    pauseIcon.classList.remove('hidden');
                    playIcon.classList.add('hidden');
                }
            }
            
            function resetView() { 
                followedObject = null; 
                controls.target.set(0, 0, 0); 
                camera.position.set(0, 100, 250);
                toggleInfoPanel(false);
            }
            
            function createSolarSystem() {
                const sunGeometry = new THREE.SphereGeometry(12, 64, 64);
                const sunMaterial = new THREE.MeshStandardMaterial({ 
                    emissive: 0xfdb813,
                    emissiveIntensity: 2,
                    map: createTexture(0xfdb813, 0xffa500)
                 });
                const sun = new THREE.Mesh(sunGeometry, sunMaterial);
                sun.name = 'Eguzkia';
                scene.add(sun);
                planets['Eguzkia'] = sun;
                addLabel(sun);

                const pointLight = new THREE.PointLight(0xffffff, 3, 3000);
                sun.add(pointLight);

                Object.keys(planetData).forEach(name => {
                    if (name === 'Eguzkia') return;
                    let size, distance, speed, color, hasMoon, hasRings;
                    switch (name) {
                        case 'Merkurio': size = 1.2; distance = 30; speed = 0.04; color = 0xaaaaaa; break;
                        case 'Artizarra (Venus)': size = 2.2; distance = 45; speed = 0.02; color = 0xd8a36a; break;
                        case 'Lurra': size = 2.5; distance = 62; speed = 0.015; color = 0x4e6d8c; hasMoon = true; break;
                        case 'Marte': size = 1.5; distance = 80; speed = 0.012; color = 0xc1440e; break;
                        case 'Jupiter': size = 7; distance = 120; speed = 0.005; color = 0xc8a487; break;
                        case 'Saturno': size = 6; distance = 160; speed = 0.003; color = 0xe3d8b8; hasRings = true; break;
                        case 'Urano': size = 4; distance = 200; speed = 0.002; color = 0xafdbf5; break;
                        case 'Neptuno': size = 3.8; distance = 240; speed = 0.0015; color = 0x3f54ba; break;
                    }
                    if (size) {
                        createPlanet(name, size, distance, speed, color, hasMoon, hasRings);
                    }
                });
            }

            function createPlanet(name, size, distance, speed, color, hasMoon = false, hasRings = false) {
                const planetGeometry = new THREE.SphereGeometry(size, 32, 32);
                const planetMaterial = new THREE.MeshStandardMaterial({ color: color, map: createTexture(color, darkenColor(color, 0.3)) });
                const planet = new THREE.Mesh(planetGeometry, planetMaterial);
                planet.name = name;
                
                const pivot = new THREE.Object3D();
                scene.add(pivot);
                pivot.add(planet);
                
                planet.position.x = distance;
                
                planet.userData = { speed: speed, distance: distance, pivot: pivot };
                planets[name] = planet;
                addLabel(planet);

                const orbitGeometry = new THREE.RingGeometry(distance - 0.2, distance + 0.2, 128);
                const orbitMaterial = new THREE.MeshBasicMaterial({ color: 0xcccccc, side: THREE.DoubleSide, opacity: 0.5, transparent: true });
                const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                orbit.rotation.x = -Math.PI / 2;
                scene.add(orbit);
                
                if(hasMoon) {
                    const moon = new THREE.Mesh(new THREE.SphereGeometry(0.5, 16, 16), new THREE.MeshStandardMaterial({ color: 0x888888 }));
                    moon.name = "Ilargia";
                    planet.add(moon);
                    moon.position.x = size + 2;
                    moon.userData = { pivot: planet };
                }

                if(hasRings) {
                    const ring = new THREE.Mesh(new THREE.RingGeometry(size + 2, size + 5, 64), new THREE.MeshBasicMaterial({ color: 0xaaa_aaa, side: THREE.DoubleSide, opacity: 0.6, transparent: true }));
                    ring.rotation.x = Math.PI * 0.4;
                    planet.add(ring);
                }
            }
            
            function createTexture(color1, color2) {
                const canvas = document.createElement('canvas');
                canvas.width = 128; canvas.height = 128;
                const context = canvas.getContext('2d');
                const gradient = context.createRadialGradient(64, 64, 0, 64, 64, 64);
                gradient.addColorStop(0, new THREE.Color(color1).getStyle());
                gradient.addColorStop(1, new THREE.Color(color2).getStyle());
                context.fillStyle = gradient;
                context.fillRect(0, 0, 128, 128);
                return new THREE.CanvasTexture(canvas);
            }

            function darkenColor(color, percent) {
                const c = new THREE.Color(color);
                c.lerp(new THREE.Color(0x000000), percent);
                return c;
            }

            function addLabel(object) {
                const labelDiv = document.createElement('div');
                labelDiv.className = 'label';
                labelDiv.textContent = object.name;
                document.getElementById('labels-container').appendChild(labelDiv);
                object.userData.label = labelDiv;
            }

            function animate() {
                requestAnimationFrame(animate);

                if (!isPaused) {
                    Object.values(planets).forEach(p => { 
                        if (p.userData.pivot) p.userData.pivot.rotation.y += p.userData.speed * 0.1;
                        p.rotation.y += 0.005; 
                    });
                }

                Object.values(planets).forEach(p => {
                    if (!p.userData.label) return;
                    const vector = new THREE.Vector3();
                    p.getWorldPosition(vector);
                    vector.project(camera);
                    
                    const x = (vector.x * 0.5 + 0.5) * renderer.domElement.clientWidth;
                    const y = (vector.y * -0.5 + 0.5) * renderer.domElement.clientHeight;

                    p.userData.label.style.transform = `translate(-50%, -150%) translate(${x}px, ${y}px)`;
                    p.userData.label.style.display = vector.z > 1 ? 'none' : 'block';
                });

                if (followedObject) {
                    followedObject.getWorldPosition(targetWorldPosition);
                    controls.target.copy(targetWorldPosition);
                }

                controls.update();
                renderer.render(scene, camera);
            }

            function onWindowResize() {
                const container = document.getElementById('container');
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
            
            function onContainerClick(event) {
                if (isMenuOpen && window.innerWidth < 768) return;

                const container = document.getElementById('container');
                const rect = container.getBoundingClientRect();
                mouse.x = ((event.clientX - rect.left) / container.clientWidth) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / container.clientHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(Object.values(planets));

                if (intersects.length > 0) {
                    const clickedObject = intersects[0].object;
                    selectObjectByName(clickedObject.name);
                } else {
                    if (selectedObject) {
                        toggleInfoPanel(false);
                    }
                }
            }

            function updateInfoPanel(name) {
                const data = planetData[name];
                if (data) { 
                    document.getElementById('planet-name').innerText = data.name;
                    document.getElementById('planet-image').src = data.image;
                    document.getElementById('planet-description').innerText = data.description;
                    document.getElementById('planet-diameter').innerText = data.diameter;
                    document.getElementById('planet-mass').innerText = data.mass;
                    document.getElementById('planet-gravity').innerText = data.gravity;
                    document.getElementById('planet-rotation').innerText = data.rotation;
                    document.getElementById('planet-orbit-period').innerText = data.orbitPeriod;
                    document.getElementById('planet-distance').innerText = data.distance;
                    document.getElementById('planet-temperature').innerText = data.temperature;
                    document.getElementById('planet-moons').innerText = data.moons;
                    toggleInfoPanel(true);

                    document.querySelectorAll('.sidebar-item').forEach(item => {
                        item.classList.toggle('active', item.dataset.name === data.name);
                    });
                }
            }
            
            function toggleInfoPanel(show) {
                const panel = document.getElementById('info-panel');
                const infoOverlay = document.getElementById('info-overlay');
                const isMobile = window.innerWidth < 768;

                if (show) {
                    panel.classList.remove('opacity-0', 'pointer-events-none');
                    if (isMobile) {
                        infoOverlay.classList.remove('hidden');
                    } else {
                        panel.style.right = '20px';
                    }
                } else {
                    panel.classList.add('opacity-0', 'pointer-events-none');
                    if (isMobile) {
                        infoOverlay.classList.add('hidden');
                    } else {
                        panel.style.right = '-400px';
                    }
                    
                    document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
                    selectedObject = null;
                }
            }


            async function shareProject() {
                const shareData = {
                    title: 'Eguzki Sistemaren Simulazioa',
                    text: 'Begiratu Eguzki-sistemaren 3D simulazio interaktibo hau!',
                    url: window.location.href
                };

                const copyToClipboard = () => {
                    const textArea = document.createElement("textarea");
                    textArea.value = window.location.href;
                    textArea.style.position = "fixed";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            const notification = document.getElementById('notification');
                            notification.classList.remove('opacity-0');
                            setTimeout(() => {
                                notification.classList.add('opacity-0');
                            }, 2000);
                        }
                    } catch (err) {
                        console.error('Ezin izan da esteka kopiatu: ', err);
                    }
                    document.body.removeChild(textArea);
                };

                if (navigator.share) {
                    try {
                        await navigator.share(shareData);
                    } catch (err) {
                        console.log("Partekatu funtzioak huts egin du, arbelean kopiatzen...", err);
                        copyToClipboard();
                    }
                } else {
                    copyToClipboard();
                }
            }
            init();
            animate();
        });
    </script>
</body>
</html>











































